{"version":3,"sources":["../../../server/routes/controllers/summonerController.js"],"names":[],"mappings":"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","file":"summonerController.js","sourcesContent":["import request from \"request\";\nimport moment from \"moment\";\n\nfunction SummonerController(req, res){\n  let status;\n  let result;\n  let dataHandler1;\n  let dataHandler2;\n  let truename = decodeURIComponent(req.params.summoner).toLowerCase().replace(/[\\s,.\\/;'\\[\\]\\\\=`<>?:\\\"{}|_+~!@#$%^&*()-]/gm, \"\");\n  if(truename.length === 0){\n    status = 404;\n    return res.redirect(`../error/${status}`);\n  }\n  let url = `https://na.api.pvp.net/api/lol/na/v1.4/summoner/by-name/${truename}?api_key=RGAPI-185B94BD-6063-4F75-81CB-B5D98501B146`;\n  let getter = (err, response, data) => {\n    if(response.statusCode > 310){\n      console.error(response.statusCode);\n      if(response.statusCode === 429){\n        if(response.headers.hasOwnProperty(\"retry-after\")){\n          request(response.request.uri.href, getter, (response.headers.retry-after * 1000));\n        }\n        else {\n          request(response.request.uri.href, getter, 5000);\n        }\n      }\n      else if(response.statusCode === 404){\n        return res.redirect(\"../error/404\");\n      }\n      else {\n        request(response.request.uri.href, getter, 5000);\n      }\n    }\n    else {\n      result = JSON.parse(data);\n      status = response.statusCode;\n      dataHandler1();\n    }\n  };\n  request(url, getter);\n  dataHandler1 = ()=> {\n    if(status > 310){\n      return res.redirect(`../error/${status}`);\n    }\n    let displayName = result[truename].name;\n    let id = result[truename].id;\n    let idResult;\n    let idStatus;\n    url = `https://na.api.pvp.net/api/lol/na/v2.5/league/by-summoner/${id}?api_key=RGAPI-185B94BD-6063-4F75-81CB-B5D98501B146`;\n    getter = (err, response, data) => {\n      if(response.statusCode > 310){\n        console.error(response.statusCode);\n        if(response.statusCode === 429){\n          if(response.headers.hasOwnProperty(\"retry-after\")){\n            request(response.request.uri.href, getter, (response.headers.retry-after * 1000));\n          }\n          else {\n            request(response.request.uri.href, getter, 5000);\n          }\n        }\n        else if(response.statusCode === 404){\n          return res.redirect(\"../error/404\");\n        }\n        else {\n          request(response.request.uri.href, getter, 5000);\n        }\n      }\n      else {\n        idResult = JSON.parse(data);\n        idStatus = response.statusCode;\n        dataHandler2();\n      }\n    };\n    request(url, getter);\n    dataHandler2 = () => {\n      if(idStatus === 404){\n        return res.redirect(\"../error/unranked\");\n      }\n      else if(idStatus > 310){\n        return res.redirect(`../error/${idStatus}`);\n      }\n      let percentageSort = (a, b) => {\n        if((Math.round((b.wins/(b.wins + b.losses))*10000)/100) === (Math.round((a.wins/(a.wins + a.losses))*10000)/100)){\n          return (b.wins + b.losses) - (a.wins + a.losses);\n        }\n        return (Math.round((b.wins/(b.wins + b.losses))*10000)/100) - (Math.round((a.wins/(a.wins + a.losses))*10000)/100);\n      };\n      idResult[id][0].entries.sort(percentageSort);\n      let hotFilter = (player) => {\n        return player.isHotStreak;\n      };\n      let winFilter = (player) => {\n        let total = player.wins + player.losses;\n        let ratio = player.wins/total;\n        return (ratio > .55) && (total > 50);\n      };\n      let hotResult = idResult[id][0].entries.filter(hotFilter);\n      let winResult = idResult[id][0].entries.filter(winFilter);\n      res.cookie('id', id, { maxAge: 2592000, httpOnly: true });\n      res.cookie('displayName', displayName, { maxAge: 2592000, httpOnly: true });\n\n      // fill out variables, given previous searches with cookies, making sure\n      // that it is the same as the person they are searching for\n      // this allows us to skip a large part of the process down below,\n      // letting us know their ID and that the account exists and is ranked.\n      // So, we make less requests and speed up the process.\n      url = `https://na.api.pvp.net/api/lol/na/v2.2/matchlist/by-summoner/${id}?rankedQueues=TEAM_BUILDER_DRAFT_RANKED_5x5,RANKED_SOLO_5x5&seasons=SEASON2016&api_key=RGAPI-185B94BD-6063-4F75-81CB-B5D98501B146`;\n      // TODO: change this url every time there is a new season, so that results\n      // will be current with year.\n      // make a request to get a list of all the match IDs that the user has\n      // played in ranked this year.\n\n      getter = (err, response, data) => {\n        if(response.statusCode > 310){\n          console.error(response.statusCode);\n          if(response.statusCode === 429){\n            if(response.headers.hasOwnProperty(\"retry-after\")){\n              request(response.request.uri.href, getter, (response.headers.retry-after * 1000));\n            }\n            else {\n              request(response.request.uri.href, getter, 5000);\n            }\n          }\n          else if(response.statusCode === 404){\n            return res.redirect(\"../error/404\");\n          }\n          else {\n            request(response.request.uri.href, getter, 5000);\n          }\n        }\n        else {\n        let matchList = JSON.parse(data);\n        let waitTime = moment.duration(((matchList.matches.length/3000)*10500) + 10000).humanize();\n        res.cookie('waitTime', (((matchList.matches.length/3000)*10500) + 10000), { maxAge: 2592000, httpOnly: false });\n        return res.render(\"summoner\", { winResult: winResult, hotResult: hotResult, name: req.params.summoner, waitTime: waitTime });\n        }\n      };\n      request(url, getter);\n    };\n  };\n}\n\nexport default SummonerController;\n"]}